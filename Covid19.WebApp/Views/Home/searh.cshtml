@{
    ViewData["Title"] = "Αρχική σελίδα";
}


@section Styles {
    <link rel="stylesheet" href="~/lib/leaflet/leaflet.min.css" />
    <link href="~/css/Leaflet.PolylineMeasure.css" rel="stylesheet" />
    <link href="~/css/L.Control.Sidebar.css" rel="stylesheet" />
    <link href="~/css/leaflet-search.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/lib/leaflet-fullscreen/Control.FullScreen.css" />
    <style type="text/css">
        #map {
            height: 800px;
            margin: 20px 20px 0 0;
        }

        .col-xs-12, .col-xs-12, .col-xs-4 {
            padding: 3px;
        }

        #divProject {
            background-color: beige;
        }

        .errorMsg {
            padding: 0;
            text-align: center;
            background-color: darksalmon;
        }
    </style>
}

@section Scripts {
    <script type="text/javascript" src="~/lib/jquery-csv/jquery.csv.min.js"></script>
    <script type="text/javascript" src="~/lib/leaflet/leaflet.min.js"></script>
    <script type="text/javascript" src="~/lib/leaflet/leaflet.js"></script>
    <script type="text/javascript" src="~/lib/leaflet-fullscreen/Control.FullScreen.min.js"></script>
    <script src="~/js/leaflet.ajax.min.js"></script>
    <script src="~/lib/leaflet/plugins/L.Control.Sidebar.js"></script>
    <script src="~/lib/leaflet/plugins/leaflet-search.js"></script>
    <script src="~/lib/leaflet/plugins/leaflet-search-geocoder.js"></script>
    <script src="~/lib/leaflet/plugins/Leaflet.PolylineMeasure.js"></script>
    <script src="~/lib/leaflet/plugins/leaflet-providers.js"></script>
    <script type="text/javascript">


        var currentPosition = new L.LatLng(38.144699504115366, 23.857665042524335);
        var mymap;
        var lyrOSM;
        var layerFiltered;
        var layerGraves;
        var layerTotalGraves;
        var lyrSearch;
        var objOverlays;
        var ctrlMeasure;
        var objOverlays;
        var ctrLayers;
        var objBaseMaps;
        var sideBar;

        $(document).ready(function() {
            mymap = L.map('map', { center: currentPosition, zoom: 13, editable: true, fullscreenControl: true });

            lyrOSM = L.tileLayer('http://{s}.google.com/vt/lyrs=p&x={x}&y={y}&z={z}',
                {
                    maxZoom: 24,
                    subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
                });
            mymap.addLayer(lyrOSM);

            sidebar = L.control.sidebar('sidebar',
                {
                    position: 'right'
                });

            mymap.addControl(sidebar);

            layerGraves = L.geoJSON.ajax('/data/agiosstefanos.json', { style: styleClientLinears, onEachFeature: processClientLinears, filter: filteredLayer }).addTo(mymap);
            layerTotalGraves = L.geoJSON.ajax('/data/agiosstefanos.json', { style: styleClientLinears, onEachFeature: processClientLinears }).addTo(mymap);

            
             var searchControl = new L.Control.Search({
                layer: layerTotalGraves,
                propertyName: 'name',
                marker: false,
                moveToLocation: function(latlng, title, map) {
                    //map.fitBounds( latlng.layer.getBounds() );
                    var zoom = map.getBoundsZoom(latlng.layer.getBounds());
                    map.setView(latlng, zoom); // access the zoom
                }
            });

            searchControl.on('search:locationfound', function(e) {
		
                //console.log('search:locationfound', );

                //map.removeLayer(this._markerSearch)

                e.layer.setStyle({fillColor: '#3f0', color: '#0f0'});
                if(e.layer._popup)
                    e.layer.openPopup();

            }).on('search:collapsed', function(e) {

                layerTotalGraves.eachLayer(function(layer) {	//restore feature color
                    layerTotalGraves.resetStyle(layer);
                });	
            });
	
            mymap.addControl( searchControl );  //inizialize search control


            @*var controlSearch = new L.Control.Search({
                position:'topright',		
                layer: layerTotalGraves,
                initial: false,
                zoom: 12,
                marker: false
            });

            mymap.addControl( controlSearch );*@


            objOverlays = { "Graves not In Use ": layerGraves, "Total Graves Capacity ": layerTotalGraves };
            ctrLayers = L.control.layers(objBaseMaps, objOverlays).addTo(mymap);

            layerGraves.on('data:loaded',
                function() {
                    mymap.fitBounds(layerGraves.getBounds());
                });

            ctrlMeasure = L.control.polylineMeasure().addTo(mymap);

        });

        function processClientLinears(feature, layer) {
            layer.bindPopup('Grave Number ' + feature.properties.OID_);
            layer.on('click', function(e) { openSidebar(e) });
            layer.on('mouseover', function() { layer.openPopup(); });

        };

        function openSidebar(selection) {
            sidebar.toggle();
            document.getElementById('grave').textContent = selection.target.feature.properties.OID_;
        }

        function filteredLayer(json) {
            if (json.properties.OID_ < 510) {
                return false;
            } else {
                return true;
            }
        }

        function styleClientLinears(json) {
            var att = json.properties;
            if (att.OID_ < 510) {
                return { color: '#874B8B' };
            } else {
                return { color: '#2C169F' };
            }
        }


        //***********************Search Functions**************

        function returnGraveById(id) {
            var aLayers = layerTotalGraves.getLayers();
            debugger;
            for (var i = 0; i < aLayers.length - 1; i++) {
                var featureId = aLayers[i].feature.properties.Project;
                if (featureId == id) {
                    return aLayers[i];
                }
            }
            return false;
        }


        $("btnFindProject").click(function() {
            var id = $("#txtFindProject").val();
            var lyr = returnGraveById(id);
            if (lyr) {
                if (lyrSearch) {
                    lyrSearch.remove();
                }
                lyrSearch = L.geoJSON(lyr.toGeoJSON(), { style: { color: 'red', weight: 10, opacity: 0.5 } }).addTo(mymap);
                mymap.fitBounds(lyr.getBounds().pad(1));
                var att = lyr.feature.properties;
                $("divProjectData").html("Tafos " + att.OID_);
            } else {
                $("#divProjectError").html("Grave not Found");
            }
        });

    </script>
}

<div class="text-center">
    <h1 class="display-4">Alfaware</h1>
</div>

<div class="">
    <div class="">
        <h2>Simulation</h2>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="row">
                <div class="col-md-12 text-center">
                    <h4>Visualize Graves</h4>
                </div>
            </div>
        </div>
    </div>
    <div class="">
        <div class="row">
            <div class="col-md-12">
                @*<div id="map"></div>*@
            </div>
            <div class="form-group">
                <div class="col-md-offset-2 col-md-10">
                    <p>&nbsp;</p>
                </div>
            </div>
        </div>
    </div>
</div>



<div id="sidebar">
    <h1>Λεπτομέρεις Τάφου </h1>

    <h5><strong>Επιλεγμένος Τάφος : </strong><span id="grave"></span> </h5>

    <p><b>Εικόνα Τάφου </b></p>

    <img src="~/foto/test.jpg" width="400" height="300" />

    <ul>
        <li><a href="listing-markers.html">listing-markers example</a></li>
        <li><a href="two-sidebars.html">two-sidebars example</a></li>
    </ul>

    <p class="lorem">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>

    <p class="lorem">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>

    <p class="lorem">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>

    <p class="lorem">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>
</div>

<div id="map"></div>

<div id="search-sidebar" class="col-md-3">
    <button id="btnLocate" class="btn btn-primary btn-block">Locate</button><br />
    <div id="divProject" class="col-xs-12">
        <div id="divProjectLabel" class="text-center col-xs-12">
            <h4>Graves</h4>
        </div>
        <div id="divProjectError" class="errorMsg col-xs-12"></div>
        <div id="divFindProject" class="form-group">
            <div class="col-xs-6">
                <input type="text" id="txtFindProject" class="form-control" placeholder="Αριθμός Τάφου" />
            </div>
            <div class="col-xs-6">
                <button id="btnFindProject" class="btn btn-primary btn-block">Εύρεση Τάφου</button>
            </div>
        </div>
        <div class="" id="divProjectData"></div>
    </div>
</div>